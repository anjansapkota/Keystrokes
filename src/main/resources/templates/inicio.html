<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
	<head>
		<title>Home</title>
		<link rel="stylesheet" type="text/css" th:href="@{/css/loginStyle.css}" />
		<link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.min.css}" />
		<link rel="stylesheet" type="text/css" th:href="@{/css/sweetalert.css}" />
 		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script th:src="@{/js/bootstrap.min.js}" type="text/javascript"></script>
		<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<link rel="stylesheet" media="screen" href="css/style.css"/>
		
	</head>
	<style>
			.background {
		  /* height:<SCRIPT>$(window).height();</SCRIPT> */
		  HEIGHT:100%;
		  position: absolute;
		  animation: bg-animation 10s infinite;
		}
		
		@-webkit-keyframes bg-animation {
		  0% {
		    background-color: #1300EB;
		  }
		  50% {
		    background-color: #43006E;
		  }
		  
		  100% {
		    background-color: #1300EB;
		  }
		}
		
		@keyframes bg-animation {
		     0% {
		    background-color: #980066;
		  }
		  50% {
		    background-color: #43006E;
		  }
		  
		  100% {
		    background-color: #980066;
		  }
		}
		
		.tabledesign{
			-webkit-border-radius: 26px 26px 26px 26px;
			-moz-border-radius:    26px 26px 26px 26px;
			border-radius:         26px 26px 26px 26px;
			background-color: rgba(54,66,81, 0.75);
			-webkit-box-shadow: #B3B3B3 2px 2px 2px;
			-moz-box-shadow:    #B3B3B3 2px 2px 2px;
			box-shadow:         #B3B3B3 2px 2px 2px;
			margin-bottom: 10%;
			text-align: center;
		}

	</style>
	<script type="text/javascript" th:inline="javascript">
	
	function alertBorrar(id){    //this is a javascript function, which will execute by reciving an id.
		swal({
			  title: "Are you sure?",
			  text: "Permanently delete this file?",
			  icon: "warning",
			  buttons: true,
			  dangerMode: true,
			})
			.then((willDelete) => {
			  if (willDelete) {
			    location.href = '/kyd/borrar/' + id;
			  } else {
			    swal("Cancelled!");
			  }
			});
	}
	
	</script>
	<script type="text/javascript" th:inline="javascript">
	
	function share(id){
		swal({
			  text: 'With whom? Enter Matricula! Use commas to separate!',
			  content: "input",
			  button: {
			    text: "Share!",
			    closeModal: false,
			  },
			})
			.then(name => {
			  if (!name) throw null;
			  location.href = '/kyd/shareFile/' + name + '/' + id;
			});
		
	}
	
	</script>
	<script type="text/javascript" th:inline="javascript">
		function descargar(link, id){
			  var number = parseInt(id);
			  location.href = '/kyd/r/' + link;
		}
	</script>
	
	<body class="">	
		<div style="position:relative;" class="background">
		<div th:fragment="menu">
		<nav class="navbar navbar-inverse">
	        <div class="container-fluid">
			    <!-- Brand and toggle get grouped for better mobile display -->
			    <div class="navbar-header">
			    	<a class="navbar-brand" href="/kyd/inicio">E65</a>
					<a class="navbar-brand text-white" href="/kyd/inicio"><strong>HOME</strong></a>
					 
			    </div>
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				    <ul class="nav navbar-nav navbar-right" style="font-size: 20px;">
				    		<li class="nav-item">
					              <a class="nav-link text-white"  style="padding-top:30%;" href="/kyd/uploadFile"><strong>UPLOAD</strong></a>
					        </li>
					        <li class="nav-item">
					              <a class="nav-link text-white"  style="padding-top:30%;" href="/kyd/listFiles"><strong>My Files</strong></a>
					        </li>
					    <li class="dropdown">
						    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><strong style="font-size: 20px;" th:text="${user}">a</strong> <span class="caret"></span></a>
						    <ul class="dropdown-menu">
						    	<li><a href="/kyd/changePassword">Change Password</a></li>
							    <li><a href="/kyd/logout">Logout</a></li>
							    <li role="separator" class="divider"></li>
							    <li><a href="#"></a></li>
						    </ul>
					    </li>
				    </ul>
			    </div><!-- /.navbar-collapse -->
		    </div><!-- /.container-fluid -->
	    </nav>
	    
	    
	    <span th:if="${requestingPasswordChange}== Si">
		<script th:inline="javascript">
		swal({
			  title: "You are about to change the password.",
			  text: "Type Carefully!!",
			  icon: "warning",
			  content: {
			    element: "input",
			    attributes: {
			      placeholder: "Type your password",
			      type: "password",
			    },
			  },
			})
			.then((willChange) => {
			  if (willChange) {
			    location.href = '/kyd/SdpmSt204snirkdT/5S4dkas2dkasdSD/' + willChange + '/aFrt6nalResaW3qw';
			  } else {
			    swal("Cancelled Changes");
			    location.href = '/kyd/listFiles'
			  }
			});    
		</script>
		</span>

	    <span th:if="${erased}== Si">
		<script th:inline="javascript">
		swal("File deleted successfully!", {
			  icon: "success",
			  buttons:false,
			  timer:1500,
			  
		});
		</script>
		</span>
		<span th:if="${erased}== No">
		<script th:inline="javascript">
		swal("You are trying to Hack, Your username shall be noted!!", {
			  icon: "warning",
			  buttons:false,
			  timer:3000,
		});
		</script>
		</span>
		
		<span th:if="${shared}== No">
		<script th:inline="javascript">
		swal("You cannot share this file!", {
			  icon: "warning",
			  buttons:false,
			  timer:1500,
		});
		</script>
		</span>
		
		<span th:if="${shared}== Si">
		<script th:inline="javascript">
		swal("File shared successfully!", {
			  icon: "success",
			  buttons:false,
			  timer:1500,
		});
		</script>
		</span>
		
		<span th:if="${fileAccess}== Denied">
		<script th:inline="javascript">
		swal("File Access Denied!", {
			  icon: "warning",
			  buttons:false,
			  timer:1500,
		});
		</script>
		</span>
		
		<span th:if="${fileAccess}== Granted">
		<script th:inline="javascript">
		swal("File Downloading", {
			  icon: "success",
			  buttons:false,
			  timer:1500,
		});
		</script>
		</span>
		
		<div class="container">
	    <div class="col-12 mt-5" style = "">
	    <h1 style="padding-left: 37%; padding-top:5px; padding-bottom: 5px; font-size: 35px; font-family: cursive; color:white;">List of your files!</h1>
	    <h1 style="padding-left: 35%; padding-top:5px; padding-bottom: 5px;"></h1>
	    <div class="table-responsive" style="font-size: 17px; color:white;">          
		  <table class="table tabledesign">
		    <thead>
	    		<tr>
				<td><h3 style="text-align: center;">File Name</h3></td>
				<td><h3 style="text-align: center;">Size</h3></td>
				<td><h3 style="text-align: center;">Date Added</h3></td>
				<td><h3 style="text-align: center;">Expiry Date</h3></td>
				<td><h3 style="text-align: center;">Accion</h3></td>
				</tr>	
		    </thead>
		    <tbody>
		      <tr th:each="fileselected : ${filesbrought}">
					<td style="padding-left: 1%;" th:text="${fileselected.file_name}">Apple</td>
					<td style="padding-left: 1%;" th:text="${fileselected.size}">a</td>
					<td style="padding-left: 1%;" th:text="${fileselected.date_added}">a</td>
					<td style="padding-left: 1%;" th:text="${fileselected.expiry_date}">a</td>
					<td style="padding-left: 1%;"><a style="padding:15px; size: 60px; height:46px;" class="btn btn-success btn-sm" th:onclick="'share(\'' +  ${fileselected.id} + '\');'">Share</a><a style="margin:5px; padding:15px; size: 60px; height:46px;"  class="btn btn-success btn-sm"  th:onclick="'descargar(\'' +  ${fileselected.file_link} +'/' + ${fileselected.id} + '\');'">Download</a> <a style="padding:15px; size: 60px; height:46px;" th:onclick="'alertBorrar(\'' +  ${fileselected.id} + '\');'" class="btn btn-danger btn-sm">Delete</a></td>
				</tr>
		    </tbody>
		  </table>
		  </div>
	    </div>
	    <div class="col-12 mt-5" style = "padding-top: 1%;">
	    <h1 style="padding-left: 35%; padding-top:5px; padding-bottom: 5px; font-size: 35px; font-family: cursive; color:white;">Files Shared to you!</h1>
	     <div class="table-responsive" style="font-size: 17px; color:white;">          
		  <table class="table tabledesign">
		    <thead>
			    		<tr>
							<td><h3  style="text-align: center;">File Name</h3></td>
							<td><h3  style="text-align: center;">Size</h3></td>
							<td><h3  style="text-align: center;">Date Added</h3></td>
							<td><h3  style="text-align: center;">Expiry Date</h3></td>
							<td><h3  style="text-align: center;">Shared By</h3></td>
							<td><h3  style="text-align: center;">Action</h3></td>
						</tr>
		    </thead>
		    <tbody>
		      <tr th:each="sharedfile : ${sharedfiles}">
					<td style="padding-left: 1%;" th:text="${sharedfile.file.file_name}">Apple</td>
					<td style="padding-left: 1%;" th:text="${sharedfile.file.size}">a</td>
					<td style="padding-left: 1%;" th:text="${sharedfile.file.date_added}">a</td>
					<td style="padding-left: 1%;" th:text="${sharedfile.file.expiry_date}">a</td>
					<td style="padding-left: 1%;" th:text="${sharedfile.file_owner_name}">a</td>	
					<td style="padding-left: 1%;"><a style="padding:15px; size: 60px; height:46px;"  class="btn btn-success btn-sm"  th:onclick="'descargar(\'' +  ${sharedfile.file.file_link} +'/' + ${sharedfile.file.id} + '\');'">Download</a> </td> 
					 
				</tr>
		    </tbody>
		  </table>
		  
		  </div>
	    </div>
	    </div>
	  </div>
	  </div>
	</body>
</html>